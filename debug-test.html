<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Booking System</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .test-button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .cal{display:grid; grid-template-columns:repeat(7,1fr); gap:.5rem; margin: 20px 0; border: 2px solid #ddd; padding: 10px; min-height: 200px;}
        .cal button{background:#111; border:2px solid #222; color:#fff; padding:1rem .5rem; font-size:1rem; border-radius:8px; cursor:pointer;}
        .cal button.available{border-color:#38bdf8;}
        .cal button.available:hover{background:#38bdf8; color:#000;}
        .day-header{text-align:center; font-size:.8rem; opacity:.7; background: #f0f0f0; padding: 10px;}
        .modal{position:fixed; inset:0; background:rgba(0,0,0,.75); display:flex; align-items:center; justify-content:center; visibility:hidden; opacity:0; transition:.25s;}
        .modal.show{visibility:visible; opacity:1;}
        .modal-content{background:#111; padding:2rem; border-radius:8px; width:90%; max-width:420px; display:flex; flex-direction:column; gap:1rem;}
        .modal-content input, .modal-content select, .modal-content button{width:100%; padding:.6rem .75rem; border-radius:4px; border:none; font-size:1rem;}
        .modal-content input, .modal-content select{background:#000; color:#fff;}
        .modal-content button{background:#38bdf8; color:#000; font-weight:700; cursor:pointer;}
        .close{background:none; border:none; color:#fff; cursor:pointer; font-size:1.2rem; align-self:flex-end;}
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug Booking System</h1>
        <div id="debug-results"></div>
        
        <button class="test-button" onclick="testCalendarButtons()">Test Calendar Buttons</button>
        <button class="test-button" onclick="testModal()">Test Modal</button>
        <button class="test-button" onclick="testBookingFunctions()">Test Booking Functions</button>
        <button class="test-button" onclick="simulateClick()">Simulate Calendar Click</button>
        
        <h3>Test Calendar:</h3>
        <div class="cal" id="test-calendar">
            <div class="day-header">Sun</div>
            <div class="day-header">Mon</div>
            <div class="day-header">Tue</div>
            <div class="day-header">Wed</div>
            <div class="day-header">Thu</div>
            <div class="day-header">Fri</div>
            <div class="day-header">Sat</div>
            
            <button class="available" data-day="1" title="Click to book this date">1</button>
            <button class="available" data-day="2" title="Click to book this date">2</button>
            <button class="available" data-day="3" title="Click to book this date">3</button>
            <button class="available" data-day="4" title="Click to book this date">4</button>
            <button class="available" data-day="5" title="Click to book this date">5</button>
            <button class="available" data-day="6" title="Click to book this date">6</button>
            <button class="available" data-day="7" title="Click to book this date">7</button>
            <button class="available" data-day="8" title="Click to book this date">8</button>
            <button class="available" data-day="9" title="Click to book this date">9</button>
            <button class="available" data-day="10" title="Click to book this date">10</button>
            <button class="available" data-day="11" title="Click to book this date">11</button>
            <button class="available" data-day="12" title="Click to book this date">12</button>
            <button class="available" data-day="13" title="Click to book this date">13</button>
            <button class="available" data-day="14" title="Click to book this date">14</button>
            <button class="available" data-day="15" title="Click to book this date">15</button>
            <button class="available" data-day="16" title="Click to book this date">16</button>
            <button class="available" data-day="17" title="Click to book this date">17</button>
            <button class="available" data-day="18" title="Click to book this date">18</button>
            <button class="available" data-day="19" title="Click to book this date">19</button>
            <button class="available" data-day="20" title="Click to book this date">20</button>
            <button class="available" data-day="21" title="Click to book this date">21</button>
            <button class="available" data-day="22" title="Click to book this date">22</button>
            <button class="available" data-day="23" title="Click to book this date">23</button>
            <button class="available" data-day="24" title="Click to book this date">24</button>
            <button class="available" data-day="25" title="Click to book this date">25</button>
            <button class="available" data-day="26" title="Click to book this date">26</button>
            <button class="available" data-day="27" title="Click to book this date">27</button>
            <button class="available" data-day="28" title="Click to book this date">28</button>
            <button class="available" data-day="29" title="Click to book this date">29</button>
            <button class="available" data-day="30" title="Click to book this date">30</button>
            <button class="available" data-day="31" title="Click to book this date">31</button>
        </div>
    </div>

    <!-- Test Modal -->
    <div class="modal" id="testModal">
        <div class="modal-content">
            <button class="close" onclick="closeModal()">&times;</button>
            <h3>Test Booking Modal</h3>
            <input type="text" id="service" placeholder="Service" value="Test Service">
            <input type="text" id="fullname" placeholder="Full Name" value="Test Customer">
            <input type="text" id="address" placeholder="Address" value="123 Test St">
            <select id="time">
                <option value="" disabled selected>Select time (24 h)</option>
                <option value="09:00">09:00</option>
                <option value="10:00">10:00</option>
                <option value="11:00">11:00</option>
                <option value="14:00">14:00</option>
                <option value="15:00">15:00</option>
            </select>
            <button onclick="submitBooking()">Book your Appointment now</button>
        </div>
    </div>

    <script>
        function addResult(message, type = 'info') {
            const results = document.getElementById('debug-results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }

        function testCalendarButtons() {
            try {
                const buttons = document.querySelectorAll('#test-calendar button[data-day]');
                addResult(`Found ${buttons.length} calendar buttons`, 'info');
                
                buttons.forEach((button, index) => {
                    if (index < 3) { // Test first 3 buttons
                        addResult(`Button ${button.dataset.day}: class="${button.className}", title="${button.title}"`, 'info');
                    }
                });
                
                addResult('‚úÖ Calendar buttons are present and properly configured', 'success');
            } catch (error) {
                addResult(`‚ùå Error testing calendar buttons: ${error.message}`, 'error');
            }
        }

        function testModal() {
            try {
                const modal = document.getElementById('testModal');
                if (modal) {
                    addResult('‚úÖ Modal element found', 'success');
                    modal.classList.add('show');
                    addResult('‚úÖ Modal opened successfully', 'success');
                    setTimeout(() => {
                        modal.classList.remove('show');
                        addResult('‚úÖ Modal closed successfully', 'success');
                    }, 2000);
                } else {
                    addResult('‚ùå Modal element not found', 'error');
                }
            } catch (error) {
                addResult(`‚ùå Error testing modal: ${error.message}`, 'error');
            }
        }

        function testBookingFunctions() {
            try {
                // Test localStorage
                localStorage.setItem('test', 'value');
                const retrieved = localStorage.getItem('test');
                localStorage.removeItem('test');
                
                if (retrieved === 'value') {
                    addResult('‚úÖ Local Storage working', 'success');
                } else {
                    addResult('‚ùå Local Storage not working', 'error');
                    return;
                }
                
                // Test booking functions
                const BOOKING_STORAGE_KEY = 'cubenotary_bookings';
                
                function getBookedAppointments() {
                    const stored = localStorage.getItem(BOOKING_STORAGE_KEY);
                    return stored ? JSON.parse(stored) : {};
                }
                
                function saveBooking(day, month, year, time, service, fullname, address) {
                    const bookings = getBookedAppointments();
                    const bookingKey = `${year}-${month}-${day}-${time}`;
                    bookings[bookingKey] = {
                        day, month, year, time, service, fullname, address,
                        bookedAt: new Date().toISOString()
                    };
                    localStorage.setItem(BOOKING_STORAGE_KEY, JSON.stringify(bookings));
                }
                
                // Test saveBooking
                saveBooking(15, 12, 2024, '14:00', 'Test Service', 'Test User', 'Test Address');
                addResult('‚úÖ saveBooking function working', 'success');
                
                // Test retrieval
                const bookings = getBookedAppointments();
                const count = Object.keys(bookings).length;
                addResult(`‚úÖ Found ${count} booking(s) in storage`, 'success');
                
            } catch (error) {
                addResult(`‚ùå Error testing booking functions: ${error.message}`, 'error');
            }
        }

        function simulateClick() {
            try {
                const button = document.querySelector('#test-calendar button[data-day="15"]');
                if (button) {
                    addResult('‚úÖ Found test button (day 15)', 'success');
                    
                    // Simulate click
                    button.click();
                    addResult('‚úÖ Button click simulated', 'success');
                    
                    // Check if modal opened
                    const modal = document.getElementById('testModal');
                    if (modal.classList.contains('show')) {
                        addResult('‚úÖ Modal opened after click', 'success');
                    } else {
                        addResult('‚ùå Modal did not open after click', 'error');
                    }
                } else {
                    addResult('‚ùå Test button not found', 'error');
                }
            } catch (error) {
                addResult(`‚ùå Error simulating click: ${error.message}`, 'error');
            }
        }

        function closeModal() {
            document.getElementById('testModal').classList.remove('show');
        }

        function submitBooking() {
            try {
                const service = document.getElementById('service').value;
                const fullname = document.getElementById('fullname').value;
                const address = document.getElementById('address').value;
                const time = document.getElementById('time').value;
                
                if (!service || !fullname || !address || !time) {
                    addResult('‚ùå Please fill all fields', 'error');
                    return;
                }
                
                // Simulate booking
                const BOOKING_STORAGE_KEY = 'cubenotary_bookings';
                const bookings = JSON.parse(localStorage.getItem(BOOKING_STORAGE_KEY) || '{}');
                const bookingKey = `2024-12-15-${time}`;
                bookings[bookingKey] = {
                    day: 15, month: 12, year: 2024, time, service, fullname, address,
                    bookedAt: new Date().toISOString()
                };
                localStorage.setItem(BOOKING_STORAGE_KEY, JSON.stringify(bookings));
                
                addResult('‚úÖ Booking submitted successfully!', 'success');
                closeModal();
                
            } catch (error) {
                addResult(`‚ùå Error submitting booking: ${error.message}`, 'error');
            }
        }

        // Add click listeners to calendar buttons
        document.addEventListener('DOMContentLoaded', function() {
            addResult('üöÄ Debug test loaded', 'info');
            
            const calendarButtons = document.querySelectorAll('#test-calendar button[data-day]');
            calendarButtons.forEach(button => {
                button.addEventListener('click', function() {
                    addResult(`üìÖ Calendar button ${this.dataset.day} clicked`, 'info');
                    document.getElementById('testModal').classList.add('show');
                });
            });
            
            addResult(`‚úÖ Added click listeners to ${calendarButtons.length} buttons`, 'success');
        });
    </script>
</body>
</html>
