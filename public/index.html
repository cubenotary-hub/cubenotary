<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Cube Notary | 24-Hr Mobile & Online Notary Chicago IL – RON, Apostille, POA - v2.4</title>
  <meta name="description" content="Cube Notary—24-hour mobile & Remote Online Notary (RON) throughout Illinois. Apostille, Power of Attorney, general notary. Call 312-468-3477 or text us.">
  <meta name="keywords" content="notary near me Chicago, mobile notary Chicago IL, 24 hour notary Illinois, Remote Online Notary RON, apostille service Chicago, power of attorney notary, Cube Notary, Illinois notary public, traveling notary Chicago">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-site-verification" content="aLu2doSVazCKBIwjEA5ZmtERc6bjFtnkDJifzhwAOaI" />
  <meta name="consent" content="granted" />
  

  <!-- Meta Pixel Code -->
  <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '1276455180998569');
    fbq('track', 'PageView');
  </script>
  <noscript><img height="1" width="1" style="display:none"
    src="https://www.facebook.com/tr?id=1276455180998569&ev=PageView&noscript=1"
  /></noscript>
  <!-- End Meta Pixel Code -->

  <!-- LocalBusiness structured data (AEO favourite) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "LocalBusiness",
    "name": "Cube Notary",
    "telephone": "+1-312-468-3477",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Chicago",
      "addressRegion": "IL",
      "addressCountry": "US"
    },
    "areaServed": "Illinois",
    "serviceType": ["General Notary", "Apostille", "Power of Attorney", "Remote Online Notary (RON)", "Mobile Notary"],
    "hoursAvailable": "Mo-Su 00:00-23:59",
    "url": "https://cubenotary.com",
    "sameAs": "https://m.yelp.com/biz/cube-notary-chicago-4"
  }
  </script>

  <!-- ========== STYLES ========== -->
  <style>
    :root{--bg:#000; --card:#111; --accent:#38bdf8; --text:#fff;}
    body{margin:0; background:var(--bg); color:var(--text); font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;}
    h2{text-align:center; margin:2rem 0 1rem; font-weight:600;}
    header{background:var(--bg); padding:4rem 1rem 1.2rem 1rem; text-align:center;}
    .logo-container{display:flex; flex-direction:column; align-items:center; gap:1rem; margin-bottom:1rem;}
    .logo{background:#dc2626; border-radius:50%; padding:1rem; box-shadow:0 4px 12px rgba(220,38,38,0.3);}
    .logo svg{display:block;}
    header h1{color:var(--text); font-size:clamp(4rem, 10vw, 7rem); font-weight:900; letter-spacing:-.03em; margin:0;}
    /* --- SERVICE NAV one-line with white bars, minimal gap --- */
    .main-service-nav{
      margin: 1.2rem auto 0.4rem auto;
      font-size: 2.5rem;
      font-weight: 700;
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: center;
      gap: 0.7rem;
      letter-spacing: -.01em;
    }
    .main-service-nav a{
      color: #38bdf8;
      text-decoration: none;
      padding: 0.08em 0.10em;
      border-radius: 7px;
      transition: background .15s;
      font-size: inherit;
      font-weight: inherit;
      white-space: nowrap;
    }
    .main-service-nav a:hover, .main-service-nav a:focus{
      background: #222;
      color: #fff;
    }
    .main-service-nav .divider-bar {
      display: inline-block;
      width: 0.14em;
      height: 1.1em;
      background: #fff;
      margin: 0 0.12em;
      border-radius: 2px;
      vertical-align: middle;
    }
    @media (max-width: 900px) {
      .main-service-nav { font-size: 1.3rem; gap: 0.4rem; }
      .main-service-nav .divider-bar { height: 1em; margin: 0 0.08em; }
    }
    @media (max-width: 600px) {
      .main-service-nav { font-size: 0.95rem; gap: 0.2rem; }
      .main-service-nav .divider-bar { height: 0.8em; margin: 0 0.05em; }
    }
    .contact-section {
      max-width: 320px;
      margin: 2.2rem auto 1.2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .contact-headline {
      font-family: 'Georgia', serif;
      font-size: 1.25rem;
      color: var(--text);
      font-weight: 700;
      margin-bottom: .7rem;
      margin-top: 0;
    }
    .contact-btn-row {
      display: flex;
      flex-direction: row;
      gap: 12px;
      justify-content: center;
      margin-bottom: 0.5rem;
    }
    .contact-btn {
      display: flex;
      align-items: center;
      gap: 0.45rem;
      font-size: 1.08rem;
      font-weight: 500;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      padding: 0.6rem 1.1rem;
      text-decoration: none;
      transition: box-shadow .15s, background .15s, color .15s;
      min-width: 82px;
      justify-content: center;
    }
    .btn-call {
      background: #12c5a7;
      color: #fff;
      font-weight: 600;
      border: none;
    }
    .btn-call:hover, .btn-call:focus {
      background: #13b193;
      color: #fff;
      box-shadow: 0 2px 8px rgba(18,197,167,0.15);
    }
    .btn-text {
      background: #000;
      color: #12c5a7;
      border: 2px solid #12c5a7;
    }
    .btn-text:hover, .btn-text:focus {
      background: #12c5a7;
      color: #fff;
    }
    .contact-btn svg {
      width: 1.1em;
      height: 1.1em;
      vertical-align: middle;
      margin-bottom: 2px;
      flex-shrink: 0;
    }
    .btn-label {
      font-size: 1.08rem;
      font-weight: 600;
      letter-spacing: 0.02em;
    }
    @media(max-width:400px){
      .contact-section{max-width:97vw;}
      .contact-btn{font-size:1rem;padding:0.5rem 0.7rem;}
      .btn-label{font-size:1rem;}
      .contact-btn-row{gap:6px;}
      .logo{transform:scale(0.8);}
    }
    .tagline{text-align:center; max-width:600px; margin:1.5rem auto 2.5rem; font-size:1.05rem; line-height:1.4;}
    .divider {border: none; border-top: 2px solid #222; margin: 2rem auto 2.5rem auto; max-width: 320px;}
    .cal-section{max-width:850px; margin:0 auto 3rem; padding:0 1rem;}
    .cal-headline{text-align:center; font-size:2rem; font-weight:700; margin-bottom:0.2rem; letter-spacing:-.02em; color:var(--accent);}
    .cal-hint{text-align:center; margin-bottom:.5rem; font-size:1.05rem; color:var(--accent); opacity:.92;}
    .cal-action{text-align:center; margin-bottom:.7rem; font-size:.98rem; color:var(--accent); opacity:.85; font-weight:500;}
    .calendar-container{max-width:400px; margin:0 auto;}
    .calendar-header{display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; padding:0 10px;}
    .calendar-header h3{margin:0; font-size:1.2em; color:var(--accent);}
    .nav-btn{background:var(--accent); color:#000; border:none; border-radius:50%; width:35px; height:35px; cursor:pointer; font-size:16px; display:flex; align-items:center; justify-content:center; transition:background .3s;}
    .nav-btn:hover{background:#fff; color:#000;}
    .cal{display:grid; grid-template-columns:repeat(7,1fr); gap:.5rem;}
    .cal button{background:var(--card); border:2px solid #222; color:var(--text); padding:1rem .5rem; font-size:1rem; border-radius:8px; cursor:pointer; transition:box-shadow .18s, border-color .18s, background .2s; box-shadow:0 0 0 transparent; position:relative; outline:none;}
    .cal button.available{border-color:var(--accent); box-shadow:0 1px 6px rgba(56,189,248,0.08);}
    .cal button.available:hover,.cal button.available:focus{background:var(--accent); color:#000; box-shadow:0 2px 12px rgba(56,189,248,0.18); border-color:var(--accent);}
    .cal button.available::after{content:"Book"; font-size:.8rem; color:var(--accent); opacity:0; position:absolute; left:50%; top:110%; transform:translateX(-50%); transition:opacity .18s; pointer-events:none;}
    .cal button.available:hover::after,.cal button.available:focus::after{opacity:.65;}
    .cal button.booked{border-color:#666; background:#333; color:#999; cursor:not-allowed;}
    .cal button.booked::after{content:"Booked"; font-size:.7rem; color:#999; opacity:1; position:absolute; left:50%; top:110%; transform:translateX(-50%);}
    .day-header{text-align:center; font-size:.8rem; opacity:.7;}
    @media(max-width:600px){.cal{font-size:.93rem;} .cal-section{padding:0;} }
    .modal{position:fixed; inset:0; background:rgba(0,0,0,.75); display:flex; align-items:center; justify-content:center; visibility:hidden; opacity:0; transition:.25s;}
    .modal.show{visibility:visible; opacity:1;}
    .modal-content{background:var(--card); padding:2rem; border-radius:8px; width:90%; max-width:420px; display:flex; flex-direction:column; gap:1rem;}
    .modal-content h3{margin:0 0 .5rem;}
    .modal-content input, .modal-content select, .modal-content button{width:100%; padding:.6rem .75rem; border-radius:4px; border:none; font-size:1rem;}
    .modal-content input, .modal-content select{background:#000; color:var(--text);}
    .modal-content button{background:#111; color:var(--accent); font-weight:700; cursor:pointer; border:2px solid var(--accent);}
    .close{align-self:flex-end; background:none; border:none; color:var(--text); cursor:pointer; font-size:1.2rem;}
    footer{background:#000; color:#fff; text-align:center; padding:2rem 1rem; font-size:.9rem;}
    footer a{color:var(--accent);}
    .footer-logo{display:flex; justify-content:center; margin-bottom:1rem;}
    .footer-logo svg{opacity:0.8;}
  </style>
</head>
<body>
  <!-- DEPLOYMENT v2.4 - Phone field removed, SMS auto-sent to (312) 468-3477 -->
  <header>
    <div class="logo-container">
      <div class="logo">
        <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="30" cy="20" r="8" fill="white"/>
          <circle cx="30" cy="20" r="4" fill="#dc2626"/>
          <rect x="26" y="28" width="8" height="2" fill="white"/>
          <rect x="24" y="32" width="12" height="2" fill="white"/>
        </svg>
      </div>
      <h1>CUBE NOTARY</h1>
    </div>
    <!-- Service nav: all on one line, minimal gap, white bars -->
    <nav class="main-service-nav">
      <a href="#general">General Notary</a>
      <span class="divider-bar"></span>
      <a href="#apostille">Apostille</a>
      <span class="divider-bar"></span>
      <a href="#poa">Power of Attorney</a>
    </nav>
    <section class="contact-section">
      <div class="contact-headline">Ready to Get Started?</div>
      <div class="contact-btn-row">
        <a class="contact-btn btn-call" href="tel:+13124683477" aria-label="Call (312) 468-3477" onclick="fbq('track', 'Contact');">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M22 16.92V19a2 2 0 01-2.18 2 19.86 19.86 0 01-8.63-3.07A19.5 19.5 0 013.07 7.81 19.86 19.86 0 010 3.18 2 2 0 012 1h2.09a2 2 0 012 1.72c.13 1.08.37 2.16.65 3.23a2 2 0 01-.45 2.09l-1.27 1.27a16 16 0 006.88 6.88l1.27-1.27a2 2 0 012.09-.45c1.07.28 2.15.52 3.23.65A2 2 0 0122 16.92z"/>
          </svg>
          <span class="btn-label">Call</span>
        </a>
        <a class="contact-btn btn-text" href="sms:+13124683477" aria-label="Text (312) 468-3477" onclick="fbq('track', 'Contact');">
          <svg fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <rect x="2" y="3" width="20" height="14" rx="3" ry="3"></rect>
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01"></path>
          </svg>
          <span class="btn-label">Text</span>
        </a>
      </div>
    </section>
  </header>

  <p class="tagline">
    Professional notary public serving all Chicago neighborhoods and all over Illinois. Mobile notary services and remote online notarization (RON) available.
  </p>
  <hr class="divider">

  <section class="cal-section">
    <div class="cal-headline">Book Your Appointment in Seconds</div>
    <div class="cal-hint">Check Availability &amp; Book Online</div>
    <div class="cal-action">Click a date to book.</div>
    <div class="calendar-container">
      <div class="calendar-header">
        <button id="prevMonth" class="nav-btn">&lt;</button>
        <h3 id="currentMonth"></h3>
        <button id="nextMonth" class="nav-btn">&gt;</button>
      </div>
      <div class="cal" id="calendar">
        <!-- Calendar will be generated dynamically by JavaScript -->
      </div>
    </div>
  </section>

  <div class="modal" id="bookModal">
    <div class="modal-content">
      <button class="close" id="closeModal" aria-label="Close">&times;</button>
      <h3>Book 24-Hr Appointment</h3>
      
      <div id="bookingForm">
        <select id="service" required>
          <option value="" disabled selected>Select Service Type</option>
          <option value="General Notary">General Notary</option>
          <option value="Apostille">Apostille</option>
          <option value="Power of Attorney">Power of Attorney</option>
          <option value="RON">Remote Online Notary (RON)</option>
          <option value="Mobile Notary">Mobile Notary</option>
        </select>
        
      <input type="text" id="fullname" placeholder="Full Name" required>
        <input type="email" id="email" placeholder="Email Address" required>
        <!-- Phone number field removed - SMS sent automatically to (312) 468-3477 - Deploy v2.3 -->
      <input type="text" id="address" placeholder="Meeting Address" required>
        
      <select id="time" required>
        <option value="" disabled selected>Select time (24 h)</option>
      </select>
        
        <textarea id="notes" placeholder="Additional notes or special requirements (optional)" rows="3"></textarea>
        
      <button id="saveBtn" style="background:#111; color:var(--accent); font-weight:700; cursor:pointer; border:2px solid var(--accent); padding:.6rem 1.2rem; border-radius:4px; font-size:1rem; margin-top: 1rem;">
          Book Appointment
      </button>
      </div>
    </div>
  </div>

  <footer>
    <div class="footer-logo">
      <svg width="40" height="40" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
        <circle cx="30" cy="20" r="8" fill="white"/>
        <circle cx="30" cy="20" r="4" fill="#dc2626"/>
        <rect x="26" y="28" width="8" height="2" fill="white"/>
        <rect x="24" y="32" width="12" height="2" fill="white"/>
      </svg>
    </div>
    <p>
      📍 <strong>Cube Notary</strong> – mobile & online 24/7 throughout Illinois.<br>
      Services: general notary, apostille, power of attorney, RON remote online notary.<br>
      Call <a href="tel:+13124683477">(312) 468-3477</a> or
      <a href="https://m.yelp.com/biz/cube-notary-chicago-4" target="_blank" rel="noopener">see our Yelp reviews</a>.
    </p>
  </footer>

  <script>
    // Updated: Simplified booking system with SMS notifications - v2.0
    // Booking system - integrated with backend API
    const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1' 
      ? 'http://localhost:3000/api' 
      : '/api';
    
    // Get available time slots for a specific date
    async function getAvailability(date) {
      try {
        const response = await fetch(`${API_BASE_URL}/bookings/availability/${date}`);
        if (!response.ok) throw new Error('Failed to fetch availability');
        const data = await response.json();
        return data.available_times || [];
      } catch (error) {
        console.error('Error fetching availability:', error);
        return [];
      }
    }
    
    // Create a new booking
    async function createBooking(bookingData) {
      try {
        const response = await fetch(`${API_BASE_URL}/bookings`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(bookingData)
        });
        
        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Failed to create booking');
        }
        
        const result = await response.json();
        return result;
      } catch (error) {
        console.error('Error creating booking:', error);
        throw error;
      }
    }
    
    // Check if a time slot is available
    async function isTimeSlotAvailable(date, time) {
      const availableTimes = await getAvailability(date);
      return availableTimes.includes(time);
    }
    


    // Initialize booking system when DOM is loaded
    // Modern Calendar System
    class ModernCalendar {
      constructor() {
        this.currentDate = new Date();
        this.calendar = document.getElementById('calendar');
        this.currentMonthEl = document.getElementById('currentMonth');
        this.prevBtn = document.getElementById('prevMonth');
        this.nextBtn = document.getElementById('nextMonth');
        
        this.monthNames = [
          'January', 'February', 'March', 'April', 'May', 'June',
          'July', 'August', 'September', 'October', 'November', 'December'
        ];
        
        this.dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        
        this.init();
      }
      
      init() {
        if (!this.calendar) {
          console.error('Calendar element not found!');
          return;
        }
        
        this.render();
        this.bindEvents();
        console.log('Modern calendar initialized successfully');
      }
      
      bindEvents() {
        if (this.prevBtn) {
          this.prevBtn.addEventListener('click', () => this.previousMonth());
        }
        if (this.nextBtn) {
          this.nextBtn.addEventListener('click', () => this.nextMonth());
        }
      }
      
      previousMonth() {
        this.currentDate.setMonth(this.currentDate.getMonth() - 1);
        this.render();
      }
      
      nextMonth() {
        this.currentDate.setMonth(this.currentDate.getMonth() + 1);
        this.render();
      }
      
      render() {
        this.renderHeader();
        this.renderCalendar();
      }
      
      renderHeader() {
        // Only render header if elements exist
        if (this.currentMonthEl) {
          const month = this.monthNames[this.currentDate.getMonth()];
          const year = this.currentDate.getFullYear();
          this.currentMonthEl.textContent = `${month} ${year}`;
        }
      }
      
      renderCalendar() {
        // Clear calendar
        this.calendar.innerHTML = '';
        
        // Add day headers
        this.dayNames.forEach(day => {
          const header = document.createElement('div');
          header.className = 'day-header';
          header.textContent = day;
          this.calendar.appendChild(header);
        });
        
        // Get month info
        const year = this.currentDate.getFullYear();
        const month = this.currentDate.getMonth();
        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        
        // Add empty cells for days before month starts
        for (let i = 0; i < firstDay; i++) {
          this.calendar.appendChild(document.createElement('div'));
        }
        
        // Add date buttons
        for (let day = 1; day <= daysInMonth; day++) {
          const button = this.createDateButton(day, month, year);
          this.calendar.appendChild(button);
        }
      }
      
      async createDateButton(day, month, year) {
        const button = document.createElement('button');
        button.textContent = day;
        button.className = 'available';
        button.title = `Click to book ${this.monthNames[month]} ${day}, ${year}`;
        
        // Check if date is in the past
        const buttonDate = new Date(year, month, day);
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        if (buttonDate < today) {
          button.className = 'booked';
          button.disabled = true;
          button.title = 'This date has passed';
        } else {
          // Check availability for this date
          const dateString = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
          const availableTimes = await getAvailability(dateString);
          
          if (availableTimes.length === 0) {
            button.className = 'booked';
            button.disabled = true;
            button.title = 'No available time slots';
          } else {
            button.title = `Click to book ${this.monthNames[month]} ${day}, ${year} (${availableTimes.length} slots available)`;
            // Add click event
            button.addEventListener('click', () => {
              console.log(`Date clicked: ${this.monthNames[month]} ${day}, ${year}`);
              this.openBookingModal(day, month, year);
            });
          }
        }
        
        return button;
      }
      
      openBookingModal(day, month, year) {
        const dateString = `${this.monthNames[month]} ${day}, ${year}`;
        console.log(`Opening booking modal for: ${dateString}`);
        
        // Create event object similar to the old system
        const event = {
          target: {
            dataset: {
              day: day,
              month: month + 1,
              year: year
            }
          }
        };
        
        openModal(event);
      }
    }
    
    // Initialize calendar when DOM is loaded
    let calendar;
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded, initializing modern calendar system...');
      
      // Initialize the modern calendar
      try {
        calendar = new ModernCalendar();
        console.log('Modern booking system initialized successfully');
        
        // Force calendar to be visible
        setTimeout(() => {
          const cal = document.getElementById('calendar');
          if (cal && cal.children.length === 0) {
            console.log('Calendar is empty, forcing regeneration...');
            calendar.render();
          }
        }, 100);
        
      } catch (error) {
        console.error('Error initializing calendar:', error);
        // Fallback: create a simple calendar
        createFallbackCalendar();
      }
    });
    
    function createFallbackCalendar() {
      const calendar = document.getElementById('calendar');
      if (!calendar) return;
      
      console.log('Creating fallback calendar...');
      
      // Clear calendar
      calendar.innerHTML = '';
      
      // Add day headers
      const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      dayNames.forEach(day => {
        const header = document.createElement('div');
        header.className = 'day-header';
        header.textContent = day;
        calendar.appendChild(header);
      });
      
      // Get current month info
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      
      // Add empty cells for days before month starts
      for (let i = 0; i < firstDay; i++) {
        calendar.appendChild(document.createElement('div'));
      }
      
      // Add date buttons
      for (let day = 1; day <= daysInMonth; day++) {
        const button = document.createElement('button');
        button.textContent = day;
        button.className = 'available';
        button.title = `Click to book ${day}`;
        
        // Check if date is in the past
        const buttonDate = new Date(year, month, day);
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        if (buttonDate < today) {
          button.className = 'booked';
          button.disabled = true;
          button.title = 'This date has passed';
        } else {
          // Add click event
          button.addEventListener('click', () => {
            console.log(`Date clicked: ${day}`);
            openModal({target: {dataset: {day: day}}});
          });
        }
        
        calendar.appendChild(button);
      }
      
      console.log(`Fallback calendar created with ${daysInMonth} days`);
    }
    
    function updateCalendarAvailability() {
      const calendarButtons = document.querySelectorAll('#calendar button[data-day]');
      const now = new Date();
      const year = now.getFullYear();
      const month = now.getMonth() + 1;
      
      calendarButtons.forEach(button => {
        const day = parseInt(button.dataset.day);
        const bookedTimes = getBookedTimesForDay(day, month, year);
        const allTimeSlots = ['00:00', '00:30', '01:00', '01:30', '02:00', '02:30', '03:00', '03:30', '04:00', '04:30', '05:00', '05:30', '06:00', '06:30', '07:00', '07:30', '08:00', '08:30', '09:00', '09:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '13:00', '13:30', '14:00', '14:30', '15:00', '15:30', '16:00', '16:30', '17:00', '17:30', '18:00', '18:30', '19:00', '19:30', '20:00', '20:30', '21:00', '21:30', '22:00', '22:30', '23:00', '23:30'];
        const availableSlots = allTimeSlots.filter(time => !bookedTimes.includes(time));
        
        if (availableSlots.length === 0) {
          button.className = "booked";
          button.title = "Fully booked";
          button.disabled = true;
          button.style.opacity = "0.5";
          button.style.cursor = "not-allowed";
        } else {
          button.className = "available";
          button.title = `Click to book this date (${availableSlots.length} slots available)`;
          button.disabled = false;
          button.style.opacity = "1";
          button.style.cursor = "pointer";
        }
      });
    }

    const modal = document.getElementById('bookModal');
    function openModal(e) {
      modal.classList.add('show');
      modal.dataset.selectedDay = e.target.dataset.day;
      
      // Update time dropdown with only available slots
      updateTimeDropdown();
      
      // Track appointment booking initiation
      fbq('track', 'InitiateCheckout');
    }
    
    async function updateTimeDropdown() {
      const selectedDay = modal.dataset.selectedDay;
      const timeSelect = document.getElementById('time');
      const now = new Date();
      const currentYear = now.getFullYear();
      const currentMonth = now.getMonth() + 1;
      
      // Clear existing options
      timeSelect.innerHTML = '<option value="" disabled selected>Loading available times...</option>';
      timeSelect.disabled = true;
      
      try {
        // Get available times for the selected date
        const dateString = `${currentYear}-${currentMonth.toString().padStart(2, '0')}-${selectedDay.padStart(2, '0')}`;
        const availableTimes = await getAvailability(dateString);
        
        // Clear and populate with available times
        timeSelect.innerHTML = '<option value="" disabled selected>Select time (24 h)</option>';
        
        if (availableTimes.length === 0) {
          timeSelect.innerHTML = '<option value="" disabled>No available times</option>';
          timeSelect.disabled = true;
        } else {
          availableTimes.forEach(time => {
            const option = document.createElement('option');
            option.value = time;
            option.textContent = time;
            timeSelect.appendChild(option);
          });
          timeSelect.disabled = false;
        }
      } catch (error) {
        console.error('Error loading available times:', error);
        timeSelect.innerHTML = '<option value="" disabled>Error loading times</option>';
        timeSelect.disabled = true;
      }
    }
    document.getElementById('closeModal').onclick = () => modal.classList.remove('show');
    
    // Close modal when clicking outside
    modal.onclick = (e) => {
      if (e.target === modal) modal.classList.remove('show');
    };
    
    // Close modal with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('show')) {
        modal.classList.remove('show');
      }
    });
    
    
    
    
    document.getElementById('saveBtn').onclick = async () => {
      const now = new Date();
      const currentYear = now.getFullYear();
      const currentMonth = now.getMonth() + 1;
      
      const payload = {
        customer_name: document.getElementById('fullname').value.trim(),
        customer_email: document.getElementById('email').value.trim(),
        // Phone number removed - SMS sent automatically to (312) 468-3477
        service_type: document.getElementById('service').value.trim(),
        appointment_date: `${currentYear}-${currentMonth.toString().padStart(2, '0')}-${modal.dataset.selectedDay.padStart(2, '0')}`,
        appointment_time: document.getElementById('time').value,
        meeting_address: document.getElementById('address').value.trim(),
        notes: document.getElementById('notes').value.trim()
      };
      
      // Validation
      if (!payload.service_type || !payload.customer_name || !payload.customer_email || !payload.meeting_address || !payload.appointment_time) {
        alert("Please complete all required fields."); 
        return;
      }
      
      // Email validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(payload.customer_email)) {
        alert("Please enter a valid email address.");
        return;
      }
      
      // Basic validation
      if (payload.customer_name.length < 2) {
        alert("Please enter a valid full name.");
        return;
      }
      
      // Disable button to prevent double submission
      const saveBtn = document.getElementById('saveBtn');
      saveBtn.disabled = true;
      saveBtn.textContent = 'Booking...';
      
      try {
        // Create booking via API
        const result = await createBooking(payload);
        
        // Track successful booking
        fbq('track', 'CompleteRegistration');
        
        // Show success message and automatically open SMS
        const smsMessage = `New appointment booked:\n\nService: ${payload.service_type}\nDate: ${payload.appointment_date}\nTime: ${payload.appointment_time}\nCustomer: ${payload.customer_name}\nEmail: ${payload.customer_email}\nAddress: ${payload.meeting_address}\nNotes: ${payload.notes}`;
        
        // Show success alert
        alert("✅ Appointment Booked Successfully!\n\n📱 SMS automatically sent to (312) 468-3477\n\nOpening SMS app for confirmation...");
        
        // Automatically open SMS app with booking details
        const smsLink = "sms:3124683477?body=" + encodeURIComponent(smsMessage);
        window.location.href = smsLink;
        
        // Close modal and refresh calendar
        modal.classList.remove('show');
        document.querySelectorAll('#bookModal input, #bookModal select, #bookModal textarea').forEach(i => i.value = '');
        
        // Refresh calendar to show updated availability
        if (calendar) {
          calendar.render();
        }
        
      } catch (error) {
        alert(`Error booking appointment: ${error.message}`);
      } finally {
        // Re-enable button
        saveBtn.disabled = false;
        saveBtn.textContent = 'Book Appointment';
      }
    };
    
    // Calendar initialization is handled above in the main DOMContentLoaded event
    
  </script>
  <!-- Trigger deployment v2.1 - Updated validation -->
</body>
</html>
