<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Booking Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .test-button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Simple Booking System Test</h1>
        <div id="results"></div>
        
        <button class="test-button" onclick="testBasicFunctions()">Test Basic Functions</button>
        <button class="test-button" onclick="testBooking()">Test Booking</button>
        <button class="test-button" onclick="showBookings()">Show All Bookings</button>
        <button class="test-button" onclick="clearBookings()">Clear All Bookings</button>
    </div>

    <script>
        const BOOKING_STORAGE_KEY = 'cubenotary_bookings';
        
        function getBookedAppointments() {
            const stored = localStorage.getItem(BOOKING_STORAGE_KEY);
            return stored ? JSON.parse(stored) : {};
        }
        
        function saveBooking(day, month, year, time, service, fullname, address) {
            const bookings = getBookedAppointments();
            const bookingKey = `${year}-${month}-${day}-${time}`;
            bookings[bookingKey] = {
                day, month, year, time, service, fullname, address,
                bookedAt: new Date().toISOString()
            };
            localStorage.setItem(BOOKING_STORAGE_KEY, JSON.stringify(bookings));
        }
        
        function isTimeSlotBooked(day, month, year, time) {
            const bookings = getBookedAppointments();
            const bookingKey = `${year}-${month}-${day}-${time}`;
            return bookings.hasOwnProperty(bookingKey);
        }
        
        function getBookedTimesForDay(day, month, year) {
            const bookings = getBookedAppointments();
            const bookedTimes = [];
            for (const key in bookings) {
                const booking = bookings[key];
                if (booking.day == day && booking.month == month && booking.year == year) {
                    bookedTimes.push(booking.time);
                }
            }
            return bookedTimes;
        }

        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }

        function testBasicFunctions() {
            try {
                addResult('üß™ Testing basic functions...', 'info');
                
                // Test localStorage
                localStorage.setItem('test', 'value');
                const retrieved = localStorage.getItem('test');
                localStorage.removeItem('test');
                
                if (retrieved === 'value') {
                    addResult('‚úÖ Local Storage: Working', 'success');
                } else {
                    addResult('‚ùå Local Storage: Failed', 'error');
                    return;
                }
                
                // Test booking functions
                const testDay = 15, testMonth = 12, testYear = 2024, testTime = '14:00';
                
                // Test saveBooking
                saveBooking(testDay, testMonth, testYear, testTime, 'Test Service', 'Test User', 'Test Address');
                addResult('‚úÖ saveBooking: Working', 'success');
                
                // Test isTimeSlotBooked
                const isBooked = isTimeSlotBooked(testDay, testMonth, testYear, testTime);
                if (isBooked) {
                    addResult('‚úÖ isTimeSlotBooked: Working', 'success');
                } else {
                    addResult('‚ùå isTimeSlotBooked: Failed', 'error');
                }
                
                // Test getBookedTimesForDay
                const bookedTimes = getBookedTimesForDay(testDay, testMonth, testYear);
                if (bookedTimes.includes(testTime)) {
                    addResult('‚úÖ getBookedTimesForDay: Working', 'success');
                } else {
                    addResult('‚ùå getBookedTimesForDay: Failed', 'error');
                }
                
                addResult('üéâ All basic functions are working!', 'success');
                
            } catch (error) {
                addResult(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        function testBooking() {
            try {
                const day = 20, month = 12, year = 2024, time = '10:00';
                
                if (isTimeSlotBooked(day, month, year, time)) {
                    addResult(`‚ö†Ô∏è Day ${day} at ${time} is already booked`, 'info');
                    return;
                }
                
                saveBooking(day, month, year, time, 'General Notary', 'Test Customer', '123 Test St');
                addResult(`‚úÖ Booked: ${month}/${day}/${year} at ${time}`, 'success');
                
                // Test double booking prevention
                if (isTimeSlotBooked(day, month, year, time)) {
                    addResult('‚úÖ Double booking prevention: Working', 'success');
                } else {
                    addResult('‚ùå Double booking prevention: Failed', 'error');
                }
                
            } catch (error) {
                addResult(`‚ùå Booking test error: ${error.message}`, 'error');
            }
        }

        function showBookings() {
            const bookings = getBookedAppointments();
            const count = Object.keys(bookings).length;
            
            if (count === 0) {
                addResult('üìã No bookings found', 'info');
                return;
            }
            
            addResult(`üìã Found ${count} booking(s):`, 'info');
            for (const key in bookings) {
                const booking = bookings[key];
                addResult(`üìÖ ${booking.month}/${booking.day}/${booking.year} at ${booking.time} - ${booking.fullname}`, 'info');
            }
        }

        function clearBookings() {
            localStorage.removeItem(BOOKING_STORAGE_KEY);
            addResult('üóëÔ∏è All bookings cleared', 'info');
        }

        // Auto-run basic test on load
        window.onload = function() {
            addResult('üöÄ Simple Booking Test Loaded', 'info');
            testBasicFunctions();
        };
    </script>
</body>
</html>
